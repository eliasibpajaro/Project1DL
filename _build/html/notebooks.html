
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Proyecto Integrador de Aprendizaje Automático - Uso de Sci-Kit &#8212; Proyecto 1 Deep Learning</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Proyecto Integrador de Aprendizaje Automático" href="Pyspark.html" />
    <link rel="prev" title="MLP en clasificación" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Proyecto 1 Deep Learning - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Proyecto 1 Deep Learning - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    MLP en clasificación
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Proyecto Integrador de Aprendizaje Automático - Uso de Sci-Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="Pyspark.html">Proyecto Integrador de Aprendizaje Automático</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebooks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Proyecto Integrador de Aprendizaje Automático - Uso de Sci-Kit</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eliminacion-de-columnas-con-mas-del-50-de-na">Eliminación de columnas con mas del 50% de NA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eliminacion-de-columnas-tipo-object-que-tienen-demasiadas-categorias">Eliminación de columnas tipo Object que tienen demasiadas categorías</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seleccion-de-variables-numericas">Selección de variables numéricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seleccion-de-variables-categorricas">Selección de variables categórricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#escalado">Escalado</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#codificacion-de-categoricas">Codificación de categóricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#division-del-train-y-test-por-clase">División del train y test por clase</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelado-con-scikit-learn">Modelado con Scikit learn</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="proyecto-integrador-de-aprendizaje-automatico-uso-de-sci-kit">
<h1>Proyecto Integrador de Aprendizaje Automático - Uso de Sci-Kit<a class="headerlink" href="#proyecto-integrador-de-aprendizaje-automatico-uso-de-sci-kit" title="Link to this heading">#</a></h1>
<p>Construir un modelo de clasificación supervisada usando MLP (Multilayer Perceptron/Red Neuronal Multicapa) para predecir si un préstamo emitido por la plataforma Lending Club resultará en default (1) o será pagado completamente (0). Se comparará el desempeño de los modelos construidos con scikit-learn y PySpark. Además, se aplicará LIME para interpretar predicciones.</p>
<section id="dataset">
<h2>Dataset<a class="headerlink" href="#dataset" title="Link to this heading">#</a></h2>
<p>Nombre: Lending Club Loan Data (2007–2020)</p>
<p>Fuente: Kaggle Dataset - Lending Club</p>
<p>Tamaño: más de 1,3 millones de registros</p>
<p>Características: variables socioeconómicas, financieras, de crédito, empleo y propósito del préstamo</p>
<p><strong>Respuesta:</strong></p>
<p>Variable binaria: loan_status</p>
<p>0 = Fully Paid</p>
<p>1 = Charged Off (default)</p>
<p>Generar la variable default basada en la columna loan_status:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>       
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;C:/Users/elias/OneDrive/Desktop/MachineLearning/JBOOKS/Project1DL/accepted_2007_to_2018Q4.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>member_id</th>
      <th>loan_amnt</th>
      <th>funded_amnt</th>
      <th>funded_amnt_inv</th>
      <th>term</th>
      <th>int_rate</th>
      <th>installment</th>
      <th>grade</th>
      <th>sub_grade</th>
      <th>...</th>
      <th>hardship_payoff_balance_amount</th>
      <th>hardship_last_payment_amount</th>
      <th>disbursement_method</th>
      <th>debt_settlement_flag</th>
      <th>debt_settlement_flag_date</th>
      <th>settlement_status</th>
      <th>settlement_date</th>
      <th>settlement_amount</th>
      <th>settlement_percentage</th>
      <th>settlement_term</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>68407277</td>
      <td>NaN</td>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>36 months</td>
      <td>13.99</td>
      <td>123.03</td>
      <td>C</td>
      <td>C4</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>N</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>68355089</td>
      <td>NaN</td>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>36 months</td>
      <td>11.99</td>
      <td>820.28</td>
      <td>C</td>
      <td>C1</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>N</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>68341763</td>
      <td>NaN</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>60 months</td>
      <td>10.78</td>
      <td>432.66</td>
      <td>B</td>
      <td>B4</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>N</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>66310712</td>
      <td>NaN</td>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>60 months</td>
      <td>14.85</td>
      <td>829.90</td>
      <td>C</td>
      <td>C5</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>N</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>68476807</td>
      <td>NaN</td>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>60 months</td>
      <td>22.45</td>
      <td>289.91</td>
      <td>F</td>
      <td>F1</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>N</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2260696</th>
      <td>88985880</td>
      <td>NaN</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>60 months</td>
      <td>10.49</td>
      <td>859.56</td>
      <td>B</td>
      <td>B3</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>N</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2260697</th>
      <td>88224441</td>
      <td>NaN</td>
      <td>24000.0</td>
      <td>24000.0</td>
      <td>24000.0</td>
      <td>60 months</td>
      <td>14.49</td>
      <td>564.56</td>
      <td>C</td>
      <td>C4</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>Y</td>
      <td>Mar-2019</td>
      <td>ACTIVE</td>
      <td>Mar-2019</td>
      <td>10000.0</td>
      <td>44.82</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2260698</th>
      <td>88215728</td>
      <td>NaN</td>
      <td>14000.0</td>
      <td>14000.0</td>
      <td>14000.0</td>
      <td>60 months</td>
      <td>14.49</td>
      <td>329.33</td>
      <td>C</td>
      <td>C4</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>N</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2260699</th>
      <td>Total amount funded in policy code 1: 1465324575</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2260700</th>
      <td>Total amount funded in policy code 2: 521953170</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>2260701 rows × 151 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;total_pymnt&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rec_prncp&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rec_int&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rec_late_fee&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;recoveries&#39;</span><span class="p">,</span> <span class="s1">&#39;last_pymnt_amnt&#39;</span><span class="p">,</span> <span class="s1">&#39;last_fico_range_high&#39;</span><span class="p">,</span> <span class="s1">&#39;last_fico_range_low&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;out_prncp&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;tax_liens&#39;</span><span class="p">,</span> <span class="s1">&#39;all_util&#39;</span><span class="p">,</span> <span class="s1">&#39;open_rv_12m&#39;</span><span class="p">,</span> <span class="s1">&#39;open_act_il&#39;</span><span class="p">,</span> <span class="s1">&#39;max_bal_bc&#39;</span><span class="p">,</span> <span class="s1">&#39;total_bal_il&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;acc_open_past_24mths&#39;</span>
                  <span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;out_prncp_inv&quot;</span><span class="p">,</span> <span class="s2">&quot;total_pymnt_inv&quot;</span><span class="p">,</span> <span class="s2">&quot;collection_recovery_fee&quot;</span><span class="p">,</span><span class="s2">&quot;debt_settlement_flag&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="eda">
<h2>EDA<a class="headerlink" href="#eda" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>member_id</th>
      <th>loan_amnt</th>
      <th>funded_amnt</th>
      <th>funded_amnt_inv</th>
      <th>term</th>
      <th>int_rate</th>
      <th>installment</th>
      <th>grade</th>
      <th>sub_grade</th>
      <th>...</th>
      <th>orig_projected_additional_accrued_interest</th>
      <th>hardship_payoff_balance_amount</th>
      <th>hardship_last_payment_amount</th>
      <th>disbursement_method</th>
      <th>debt_settlement_flag_date</th>
      <th>settlement_status</th>
      <th>settlement_date</th>
      <th>settlement_amount</th>
      <th>settlement_percentage</th>
      <th>settlement_term</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>68407277</td>
      <td>NaN</td>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>36 months</td>
      <td>13.99</td>
      <td>123.03</td>
      <td>C</td>
      <td>C4</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>68355089</td>
      <td>NaN</td>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>36 months</td>
      <td>11.99</td>
      <td>820.28</td>
      <td>C</td>
      <td>C1</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>68341763</td>
      <td>NaN</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>60 months</td>
      <td>10.78</td>
      <td>432.66</td>
      <td>B</td>
      <td>B4</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>66310712</td>
      <td>NaN</td>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>60 months</td>
      <td>14.85</td>
      <td>829.90</td>
      <td>C</td>
      <td>C5</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>68476807</td>
      <td>NaN</td>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>60 months</td>
      <td>22.45</td>
      <td>289.91</td>
      <td>F</td>
      <td>F1</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 131 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;idx_ls = df.columns.get_loc(&quot;loan_status&quot;)</span>

<span class="sd">df_pre = df.iloc[:, :idx_ls].copy()</span>

<span class="sd">print(&quot;Columnas antes de loan_status:&quot;, df_pre.columns.tolist())</span>
<span class="sd">print(&quot;Shape final:&quot;, df_pre.shape)&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;idx_ls = df.columns.get_loc(&quot;loan_status&quot;)\n\ndf_pre = df.iloc[:, :idx_ls].copy()\n\nprint(&quot;Columnas antes de loan_status:&quot;, df_pre.columns.tolist())\nprint(&quot;Shape final:&quot;, df_pre.shape)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;Charged Off&quot;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;member_id&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>loan_amnt</th>
      <th>funded_amnt</th>
      <th>funded_amnt_inv</th>
      <th>term</th>
      <th>int_rate</th>
      <th>installment</th>
      <th>grade</th>
      <th>sub_grade</th>
      <th>emp_title</th>
      <th>...</th>
      <th>hardship_payoff_balance_amount</th>
      <th>hardship_last_payment_amount</th>
      <th>disbursement_method</th>
      <th>debt_settlement_flag_date</th>
      <th>settlement_status</th>
      <th>settlement_date</th>
      <th>settlement_amount</th>
      <th>settlement_percentage</th>
      <th>settlement_term</th>
      <th>default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>68407277</td>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>36 months</td>
      <td>13.99</td>
      <td>123.03</td>
      <td>C</td>
      <td>C4</td>
      <td>leadman</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>68355089</td>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>36 months</td>
      <td>11.99</td>
      <td>820.28</td>
      <td>C</td>
      <td>C1</td>
      <td>Engineer</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>68341763</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>60 months</td>
      <td>10.78</td>
      <td>432.66</td>
      <td>B</td>
      <td>B4</td>
      <td>truck driver</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>66310712</td>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>60 months</td>
      <td>14.85</td>
      <td>829.90</td>
      <td>C</td>
      <td>C5</td>
      <td>Information Systems Officer</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>68476807</td>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>60 months</td>
      <td>22.45</td>
      <td>289.91</td>
      <td>F</td>
      <td>F1</td>
      <td>Contract Specialist</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2260696</th>
      <td>88985880</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>60 months</td>
      <td>10.49</td>
      <td>859.56</td>
      <td>B</td>
      <td>B3</td>
      <td>Vice President</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260697</th>
      <td>88224441</td>
      <td>24000.0</td>
      <td>24000.0</td>
      <td>24000.0</td>
      <td>60 months</td>
      <td>14.49</td>
      <td>564.56</td>
      <td>C</td>
      <td>C4</td>
      <td>Program Manager</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>Mar-2019</td>
      <td>ACTIVE</td>
      <td>Mar-2019</td>
      <td>10000.0</td>
      <td>44.82</td>
      <td>1.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2260698</th>
      <td>88215728</td>
      <td>14000.0</td>
      <td>14000.0</td>
      <td>14000.0</td>
      <td>60 months</td>
      <td>14.49</td>
      <td>329.33</td>
      <td>C</td>
      <td>C4</td>
      <td>Customer Service Technician</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Cash</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260699</th>
      <td>Total amount funded in policy code 1: 1465324575</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260700</th>
      <td>Total amount funded in policy code 2: 521953170</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2260701 rows × 131 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- 2. Información general ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tipos de datos y valores nulos:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Valores faltantes:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tipos de datos y valores nulos:
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2260701 entries, 0 to 2260700
Columns: 131 entries, id to default
dtypes: float64(93), int64(1), object(37)
memory usage: 2.2+ GB
None

Valores faltantes:
id                             0
loan_amnt                     33
funded_amnt                   33
funded_amnt_inv               33
term                          33
                          ...   
settlement_date          2226455
settlement_amount        2226455
settlement_percentage    2226455
settlement_term          2226455
default                        0
Length: 131, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="eliminacion-de-columnas-con-mas-del-50-de-na">
<h2>Eliminación de columnas con mas del 50% de NA<a class="headerlink" href="#eliminacion-de-columnas-con-mas-del-50-de-na" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.5</span>  
<span class="n">na_ratio</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">keep_cols</span> <span class="o">=</span> <span class="n">na_ratio</span><span class="p">[</span><span class="n">na_ratio</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">keep_cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columnas originales:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columnas eliminadas:&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columnas finales:&quot;</span><span class="p">,</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Columnas originales: 131
Columnas eliminadas: 43
Columnas finales: 88
</pre></div>
</div>
</div>
</div>
</section>
<section id="eliminacion-de-columnas-tipo-object-que-tienen-demasiadas-categorias">
<h2>Eliminación de columnas tipo Object que tienen demasiadas categorías<a class="headerlink" href="#eliminacion-de-columnas-tipo-object-que-tienen-demasiadas-categorias" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_filtered</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>loan_amnt</th>
      <th>funded_amnt</th>
      <th>funded_amnt_inv</th>
      <th>term</th>
      <th>int_rate</th>
      <th>installment</th>
      <th>grade</th>
      <th>sub_grade</th>
      <th>emp_title</th>
      <th>...</th>
      <th>pct_tl_nvr_dlq</th>
      <th>percent_bc_gt_75</th>
      <th>pub_rec_bankruptcies</th>
      <th>tot_hi_cred_lim</th>
      <th>total_bal_ex_mort</th>
      <th>total_bc_limit</th>
      <th>total_il_high_credit_limit</th>
      <th>hardship_flag</th>
      <th>disbursement_method</th>
      <th>default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>68407277</td>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>36 months</td>
      <td>13.99</td>
      <td>123.03</td>
      <td>C</td>
      <td>C4</td>
      <td>leadman</td>
      <td>...</td>
      <td>76.9</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>178050.0</td>
      <td>7746.0</td>
      <td>2400.0</td>
      <td>13734.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>68355089</td>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>36 months</td>
      <td>11.99</td>
      <td>820.28</td>
      <td>C</td>
      <td>C1</td>
      <td>Engineer</td>
      <td>...</td>
      <td>97.4</td>
      <td>7.7</td>
      <td>0.0</td>
      <td>314017.0</td>
      <td>39475.0</td>
      <td>79300.0</td>
      <td>24667.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>68341763</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>60 months</td>
      <td>10.78</td>
      <td>432.66</td>
      <td>B</td>
      <td>B4</td>
      <td>truck driver</td>
      <td>...</td>
      <td>100.0</td>
      <td>50.0</td>
      <td>0.0</td>
      <td>218418.0</td>
      <td>18696.0</td>
      <td>6200.0</td>
      <td>14877.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>66310712</td>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>60 months</td>
      <td>14.85</td>
      <td>829.90</td>
      <td>C</td>
      <td>C5</td>
      <td>Information Systems Officer</td>
      <td>...</td>
      <td>100.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>381215.0</td>
      <td>52226.0</td>
      <td>62500.0</td>
      <td>18000.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>68476807</td>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>60 months</td>
      <td>22.45</td>
      <td>289.91</td>
      <td>F</td>
      <td>F1</td>
      <td>Contract Specialist</td>
      <td>...</td>
      <td>96.6</td>
      <td>60.0</td>
      <td>0.0</td>
      <td>439570.0</td>
      <td>95768.0</td>
      <td>20300.0</td>
      <td>88097.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2260696</th>
      <td>88985880</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>60 months</td>
      <td>10.49</td>
      <td>859.56</td>
      <td>B</td>
      <td>B3</td>
      <td>Vice President</td>
      <td>...</td>
      <td>75.7</td>
      <td>50.0</td>
      <td>0.0</td>
      <td>55970.0</td>
      <td>28398.0</td>
      <td>12300.0</td>
      <td>42670.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260697</th>
      <td>88224441</td>
      <td>24000.0</td>
      <td>24000.0</td>
      <td>24000.0</td>
      <td>60 months</td>
      <td>14.49</td>
      <td>564.56</td>
      <td>C</td>
      <td>C4</td>
      <td>Program Manager</td>
      <td>...</td>
      <td>96.2</td>
      <td>40.0</td>
      <td>1.0</td>
      <td>84664.0</td>
      <td>62426.0</td>
      <td>20700.0</td>
      <td>58764.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2260698</th>
      <td>88215728</td>
      <td>14000.0</td>
      <td>14000.0</td>
      <td>14000.0</td>
      <td>60 months</td>
      <td>14.49</td>
      <td>329.33</td>
      <td>C</td>
      <td>C4</td>
      <td>Customer Service Technician</td>
      <td>...</td>
      <td>81.8</td>
      <td>50.0</td>
      <td>0.0</td>
      <td>163804.0</td>
      <td>44215.0</td>
      <td>9500.0</td>
      <td>34169.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260699</th>
      <td>Total amount funded in policy code 1: 1465324575</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260700</th>
      <td>Total amount funded in policy code 2: 521953170</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2260701 rows × 88 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_cols</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="k">def</span><span class="w"> </span><span class="nf">drop_high_cardinality_objects</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">cat_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">max_unique</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>                 <span class="c1"># umbral absoluto</span>
    <span class="n">max_ratio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>    <span class="c1"># umbral relativo</span>
    <span class="n">count_na_as_category</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>

    <span class="c1"># Cardinalidad por columna</span>
    <span class="n">nun</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cat_cols</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="ow">not</span> <span class="n">count_na_as_category</span><span class="p">)</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># Criterios</span>
    <span class="n">to_drop_abs</span> <span class="o">=</span> <span class="n">nun</span><span class="p">[</span><span class="n">nun</span> <span class="o">&gt;</span> <span class="n">max_unique</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">to_drop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">to_drop_abs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nrows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ratios</span> <span class="o">=</span> <span class="n">nun</span> <span class="o">/</span> <span class="n">nrows</span>
        <span class="n">to_drop_rel</span> <span class="o">=</span> <span class="n">ratios</span><span class="p">[</span><span class="n">ratios</span> <span class="o">&gt;</span> <span class="n">max_ratio</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="n">to_drop</span> <span class="o">=</span> <span class="n">to_drop</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">to_drop_rel</span><span class="p">))</span>

    <span class="c1"># DataFrame resumen</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;nunique&quot;</span><span class="p">:</span> <span class="n">nun</span><span class="p">,</span>
        <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="n">nun</span> <span class="o">/</span> <span class="n">nrows</span> <span class="k">if</span> <span class="n">nrows</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="s2">&quot;drop&quot;</span><span class="p">:</span> <span class="n">nun</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">to_drop</span><span class="p">)</span>
    <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;nunique&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">df_out</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_drop</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_out</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_drop</span><span class="p">)</span>


<span class="n">df_filtered</span><span class="p">,</span> <span class="n">card_summary</span><span class="p">,</span> <span class="n">dropped</span> <span class="o">=</span> <span class="n">drop_high_cardinality_objects</span><span class="p">(</span>
    <span class="n">df_filtered</span><span class="p">,</span> <span class="n">cat_cols</span><span class="o">=</span><span class="n">cat_cols</span><span class="p">,</span> <span class="n">max_unique</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Columnas eliminadas por alta cardinalidad:&quot;</span><span class="p">,</span> <span class="n">dropped</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Columnas eliminadas por alta cardinalidad: [&#39;issue_d&#39;, &#39;emp_title&#39;, &#39;last_pymnt_d&#39;, &#39;id&#39;, &#39;title&#39;, &#39;last_credit_pull_d&#39;, &#39;earliest_cr_line&#39;, &#39;zip_code&#39;, &#39;url&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">card_summary</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                     nunique         ratio   drop
id                   2260701  1.000000e+00   True
url                  2260668  9.999854e-01   True
emp_title             512694  2.267854e-01   True
title                  63154  2.793558e-02   True
zip_code                 956  4.228777e-04   True
earliest_cr_line         754  3.335249e-04   True
last_credit_pull_d       141  6.237003e-05   True
issue_d                  139  6.148535e-05   True
last_pymnt_d             136  6.015833e-05   True
addr_state                51  2.255937e-05  False
sub_grade                 35  1.548192e-05  False
purpose                   14  6.192769e-06  False
emp_length                11  4.865747e-06  False
loan_status                9  3.981066e-06  False
grade                      7  3.096385e-06  False
home_ownership             6  2.654044e-06  False
verification_status        3  1.327022e-06  False
term                       2  8.846813e-07  False
pymnt_plan                 2  8.846813e-07  False
initial_list_status        2  8.846813e-07  False
application_type           2  8.846813e-07  False
hardship_flag              2  8.846813e-07  False
disbursement_method        2  8.846813e-07  False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_filtered</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loan_amnt</th>
      <th>funded_amnt</th>
      <th>funded_amnt_inv</th>
      <th>term</th>
      <th>int_rate</th>
      <th>installment</th>
      <th>grade</th>
      <th>sub_grade</th>
      <th>emp_length</th>
      <th>home_ownership</th>
      <th>...</th>
      <th>pct_tl_nvr_dlq</th>
      <th>percent_bc_gt_75</th>
      <th>pub_rec_bankruptcies</th>
      <th>tot_hi_cred_lim</th>
      <th>total_bal_ex_mort</th>
      <th>total_bc_limit</th>
      <th>total_il_high_credit_limit</th>
      <th>hardship_flag</th>
      <th>disbursement_method</th>
      <th>default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>3600.0</td>
      <td>36 months</td>
      <td>13.99</td>
      <td>123.03</td>
      <td>C</td>
      <td>C4</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>...</td>
      <td>76.9</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>178050.0</td>
      <td>7746.0</td>
      <td>2400.0</td>
      <td>13734.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>24700.0</td>
      <td>36 months</td>
      <td>11.99</td>
      <td>820.28</td>
      <td>C</td>
      <td>C1</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>...</td>
      <td>97.4</td>
      <td>7.7</td>
      <td>0.0</td>
      <td>314017.0</td>
      <td>39475.0</td>
      <td>79300.0</td>
      <td>24667.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>60 months</td>
      <td>10.78</td>
      <td>432.66</td>
      <td>B</td>
      <td>B4</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>...</td>
      <td>100.0</td>
      <td>50.0</td>
      <td>0.0</td>
      <td>218418.0</td>
      <td>18696.0</td>
      <td>6200.0</td>
      <td>14877.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>35000.0</td>
      <td>60 months</td>
      <td>14.85</td>
      <td>829.90</td>
      <td>C</td>
      <td>C5</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>...</td>
      <td>100.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>381215.0</td>
      <td>52226.0</td>
      <td>62500.0</td>
      <td>18000.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>10400.0</td>
      <td>60 months</td>
      <td>22.45</td>
      <td>289.91</td>
      <td>F</td>
      <td>F1</td>
      <td>3 years</td>
      <td>MORTGAGE</td>
      <td>...</td>
      <td>96.6</td>
      <td>60.0</td>
      <td>0.0</td>
      <td>439570.0</td>
      <td>95768.0</td>
      <td>20300.0</td>
      <td>88097.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2260696</th>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>40000.0</td>
      <td>60 months</td>
      <td>10.49</td>
      <td>859.56</td>
      <td>B</td>
      <td>B3</td>
      <td>9 years</td>
      <td>MORTGAGE</td>
      <td>...</td>
      <td>75.7</td>
      <td>50.0</td>
      <td>0.0</td>
      <td>55970.0</td>
      <td>28398.0</td>
      <td>12300.0</td>
      <td>42670.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260697</th>
      <td>24000.0</td>
      <td>24000.0</td>
      <td>24000.0</td>
      <td>60 months</td>
      <td>14.49</td>
      <td>564.56</td>
      <td>C</td>
      <td>C4</td>
      <td>6 years</td>
      <td>RENT</td>
      <td>...</td>
      <td>96.2</td>
      <td>40.0</td>
      <td>1.0</td>
      <td>84664.0</td>
      <td>62426.0</td>
      <td>20700.0</td>
      <td>58764.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2260698</th>
      <td>14000.0</td>
      <td>14000.0</td>
      <td>14000.0</td>
      <td>60 months</td>
      <td>14.49</td>
      <td>329.33</td>
      <td>C</td>
      <td>C4</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>...</td>
      <td>81.8</td>
      <td>50.0</td>
      <td>0.0</td>
      <td>163804.0</td>
      <td>44215.0</td>
      <td>9500.0</td>
      <td>34169.0</td>
      <td>N</td>
      <td>Cash</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260699</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260700</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2260701 rows × 79 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- 3. Distribución de la variable &#39;default&#39; ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Distribución de &#39;default&#39;:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribución de la variable default&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Distribución de &#39;default&#39;:
default
0    0.881205
1    0.118795
Name: proportion, dtype: float64
</pre></div>
</div>
<img alt="_images/931cc3e57eae54e2f36dd8991b06af0ed7c3f582de0c7226b1bc5d53c9864031.png" src="_images/931cc3e57eae54e2f36dd8991b06af0ed7c3f582de0c7226b1bc5d53c9864031.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Histogramas SOLO de variables flotantes ---</span>
<span class="n">float_cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">])</span>  <span class="c1"># selecciona solo columnas flotantes</span>

<span class="n">float_cols</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Histogramas de variables flotantes&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bfd29d2e3715448ccc4ee18236db32d1ee850740ff4dc48b27f9c700d7f90905.png" src="_images/bfd29d2e3715448ccc4ee18236db32d1ee850740ff4dc48b27f9c700d7f90905.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">cat_cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;id&#39;, &#39;term&#39;, &#39;grade&#39;, &#39;sub_grade&#39;, &#39;emp_title&#39;, &#39;emp_length&#39;,
       &#39;home_ownership&#39;, &#39;verification_status&#39;, &#39;issue_d&#39;, &#39;loan_status&#39;,
       &#39;pymnt_plan&#39;, &#39;url&#39;, &#39;desc&#39;, &#39;purpose&#39;, &#39;title&#39;, &#39;zip_code&#39;,
       &#39;addr_state&#39;, &#39;earliest_cr_line&#39;, &#39;initial_list_status&#39;, &#39;last_pymnt_d&#39;,
       &#39;next_pymnt_d&#39;, &#39;last_credit_pull_d&#39;, &#39;application_type&#39;,
       &#39;verification_status_joint&#39;, &#39;sec_app_earliest_cr_line&#39;,
       &#39;hardship_flag&#39;, &#39;hardship_type&#39;, &#39;hardship_reason&#39;, &#39;hardship_status&#39;,
       &#39;hardship_start_date&#39;, &#39;hardship_end_date&#39;, &#39;payment_plan_start_date&#39;,
       &#39;hardship_loan_status&#39;, &#39;disbursement_method&#39;,
       &#39;debt_settlement_flag_date&#39;, &#39;settlement_status&#39;, &#39;settlement_date&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- 6. Matriz de correlación / Heatmap ---</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">corr</span> <span class="o">=</span> <span class="n">float_cols</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Matriz de correlación&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d5ae2083c1d80799065031a24f2bda7c9d0b13528ae3e412dcf186b5bb24106d.png" src="_images/d5ae2083c1d80799065031a24f2bda7c9d0b13528ae3e412dcf186b5bb24106d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="seleccion-de-variables-numericas">
<h2>Selección de variables numéricas<a class="headerlink" href="#seleccion-de-variables-numericas" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_num</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="s2">&quot;int64&quot;</span><span class="p">])</span>
<span class="n">df_cat</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span>
<span class="n">df_cat</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lasso</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeLASSOnuevo</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
                         <span class="p">(</span><span class="s2">&quot;lasso&quot;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span> <span class="mf">0.0001</span><span class="p">))])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#pipeLASSOnuevo.fit(X_train, y_train)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;lasso = Lasso().fit(X_trainRidge, y_trainRidge)</span>
<span class="sd">print(&quot;Training set score: {:.2f}&quot;.format(lasso.score(X_trainRidge, y_trainRidge)))</span>
<span class="sd">print(&quot;Test set score: {:.2f}&quot;.format(lasso.score(X_testRidge, y_testRidge)))</span>
<span class="sd">print(&quot;Number of features used: {}&quot;.format(np.sum(lasso.coef_ != 0)))&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;lasso = Lasso().fit(X_trainRidge, y_trainRidge)\nprint(&quot;Training set score: {:.2f}&quot;.format(lasso.score(X_trainRidge, y_trainRidge)))\nprint(&quot;Test set score: {:.2f}&quot;.format(lasso.score(X_testRidge, y_testRidge)))\nprint(&quot;Number of features used: {}&quot;.format(np.sum(lasso.coef_ != 0)))&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Todas las numéricas</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Todas las categóricas (tipo object o string)</span>
<span class="n">cat_cols</span> <span class="o">=</span> <span class="n">df_cat</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numéricas:&quot;</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Categóricas:&quot;</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Numéricas: [&#39;loan_amnt&#39;, &#39;funded_amnt&#39;, &#39;funded_amnt_inv&#39;, &#39;int_rate&#39;, &#39;installment&#39;, &#39;annual_inc&#39;, &#39;dti&#39;, &#39;delinq_2yrs&#39;, &#39;fico_range_low&#39;, &#39;fico_range_high&#39;, &#39;inq_last_6mths&#39;, &#39;open_acc&#39;, &#39;pub_rec&#39;, &#39;revol_bal&#39;, &#39;revol_util&#39;, &#39;total_acc&#39;, &#39;collections_12_mths_ex_med&#39;, &#39;policy_code&#39;, &#39;acc_now_delinq&#39;, &#39;tot_coll_amt&#39;, &#39;tot_cur_bal&#39;, &#39;open_acc_6m&#39;, &#39;open_il_12m&#39;, &#39;open_il_24m&#39;, &#39;mths_since_rcnt_il&#39;, &#39;il_util&#39;, &#39;open_rv_24m&#39;, &#39;total_rev_hi_lim&#39;, &#39;inq_fi&#39;, &#39;total_cu_tl&#39;, &#39;inq_last_12m&#39;, &#39;avg_cur_bal&#39;, &#39;bc_open_to_buy&#39;, &#39;bc_util&#39;, &#39;chargeoff_within_12_mths&#39;, &#39;delinq_amnt&#39;, &#39;mo_sin_old_il_acct&#39;, &#39;mo_sin_old_rev_tl_op&#39;, &#39;mo_sin_rcnt_rev_tl_op&#39;, &#39;mo_sin_rcnt_tl&#39;, &#39;mort_acc&#39;, &#39;mths_since_recent_bc&#39;, &#39;mths_since_recent_inq&#39;, &#39;num_accts_ever_120_pd&#39;, &#39;num_actv_bc_tl&#39;, &#39;num_actv_rev_tl&#39;, &#39;num_bc_sats&#39;, &#39;num_bc_tl&#39;, &#39;num_il_tl&#39;, &#39;num_op_rev_tl&#39;, &#39;num_rev_accts&#39;, &#39;num_rev_tl_bal_gt_0&#39;, &#39;num_sats&#39;, &#39;num_tl_120dpd_2m&#39;, &#39;num_tl_30dpd&#39;, &#39;num_tl_90g_dpd_24m&#39;, &#39;num_tl_op_past_12m&#39;, &#39;pct_tl_nvr_dlq&#39;, &#39;percent_bc_gt_75&#39;, &#39;pub_rec_bankruptcies&#39;, &#39;tot_hi_cred_lim&#39;, &#39;total_bal_ex_mort&#39;, &#39;total_bc_limit&#39;, &#39;total_il_high_credit_limit&#39;, &#39;default&#39;]
Categóricas: [&#39;term&#39;, &#39;grade&#39;, &#39;sub_grade&#39;, &#39;emp_length&#39;, &#39;home_ownership&#39;, &#39;verification_status&#39;, &#39;pymnt_plan&#39;, &#39;purpose&#39;, &#39;addr_state&#39;, &#39;initial_list_status&#39;, &#39;application_type&#39;, &#39;hardship_flag&#39;, &#39;disbursement_method&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>

<span class="c1"># Numéricas: imputación + escalado</span>
<span class="n">num_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="p">])</span>

<span class="c1"># Categóricas: imputación + OneHot</span>
<span class="n">cat_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;__MISSING__&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse_output</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># ColumnTransformer con separación clara</span>
<span class="n">prepro</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">num_transformer</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">cat_transformer</span><span class="p">,</span> <span class="n">cat_cols</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- 6. Matriz de correlación / Heatmap ---</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">corr</span> <span class="o">=</span> <span class="n">df_num</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Matriz de correlación&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a9eb2a310201987cf162fa21305b9be64158ae15290cacaa8b695ec2b3c93366.png" src="_images/a9eb2a310201987cf162fa21305b9be64158ae15290cacaa8b695ec2b3c93366.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ================== IMPORTS ==================</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.feature_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">SelectFromModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">roc_auc_score</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ================== 0) DATOS: X (numéricas) y y (target) ==================</span>
<span class="c1"># df_num: DataFrame SOLO con variables numéricas</span>
<span class="c1"># df_filtered[&#39;default&#39;]: variable objetivo (0/1)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_num</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_num</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">]</span>

<span class="c1"># Limpieza mínima: quita filas con NaN en X o en y</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">y</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Calcula la matriz de correlación de X (sin incluir default)</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

<span class="c1"># 2. Crea máscara triangular superior (para no repetir pares)</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>

<span class="c1"># 3. Elimina columnas con correlación alta</span>
<span class="n">umbral</span> <span class="o">=</span> <span class="mf">0.85</span>
<span class="n">cols_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">umbral</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables eliminadas por alta correlación:&quot;</span><span class="p">,</span> <span class="n">cols_drop</span><span class="p">)</span>

<span class="n">X_reduced</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols_drop</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X_reduced</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variables eliminadas por alta correlación: [&#39;funded_amnt&#39;, &#39;funded_amnt_inv&#39;, &#39;installment&#39;, &#39;fico_range_high&#39;, &#39;bc_util&#39;, &#39;num_rev_tl_bal_gt_0&#39;, &#39;num_sats&#39;, &#39;tot_hi_cred_lim&#39;, &#39;total_bc_limit&#39;, &#39;total_il_high_credit_limit&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ================== 1) SPLIT ESTRATIFICADO 80/20 ==================</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ================== 2) PREPROCESADOR (numéricas) ==================</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">prepro</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
        <span class="p">]),</span> <span class="n">num_cols</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span>
<span class="p">)</span>

<span class="c1"># ================== 3) SELECTOR L1 (ajusta C aquí) ==================</span>
<span class="n">C_MANUAL</span> <span class="o">=</span> <span class="mf">0.0001</span>          <span class="c1"># &lt;&lt;&lt; ajusta este valor (menor C = más regularización)</span>
<span class="n">THRESH</span> <span class="o">=</span> <span class="mf">1e-8</span>            <span class="c1"># &lt;&lt;&lt; umbral para &quot;coeficientes ≠ 0&quot; (puedes subir/bajar)</span>

<span class="n">selector_l1</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span>
    <span class="n">LogisticRegression</span><span class="p">(</span>
        <span class="n">penalty</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;saga&quot;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C_MANUAL</span>
    <span class="p">),</span>
    <span class="n">threshold</span><span class="o">=</span><span class="n">THRESH</span>
<span class="p">)</span>

<span class="n">pipe_sel</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;prepro&quot;</span><span class="p">,</span> <span class="n">prepro</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;sel&quot;</span><span class="p">,</span> <span class="n">selector_l1</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Entrenar selector</span>
<span class="n">pipe_sel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># ================== 4) FEATURES SELECCIONADAS ==================</span>
<span class="c1"># Nombres de columnas tras el prepro</span>
<span class="n">feat_names_trans</span> <span class="o">=</span> <span class="n">pipe_sel</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;prepro&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
<span class="n">mask_sel</span> <span class="o">=</span> <span class="n">pipe_sel</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;sel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_support</span><span class="p">()</span>
<span class="n">selected_trans</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">keep</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">feat_names_trans</span><span class="p">,</span> <span class="n">mask_sel</span><span class="p">)</span> <span class="k">if</span> <span class="n">keep</span><span class="p">]</span>

<span class="c1"># Mapea a nombres originales (quita el prefijo &#39;num__&#39;)</span>
<span class="n">selected_original</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;__&quot;</span> <span class="ow">in</span> <span class="n">name</span> <span class="k">else</span> <span class="n">name</span>
                     <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">selected_trans</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nº de variables seleccionadas: </span><span class="si">{</span><span class="n">mask_sel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Primeras seleccionadas:&quot;</span><span class="p">,</span> <span class="n">selected_original</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>

<span class="c1"># Matrices reducidas para modelado</span>
<span class="n">X_train_sel</span> <span class="o">=</span> <span class="n">pipe_sel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_sel</span>  <span class="o">=</span> <span class="n">pipe_sel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># ================== 5) EVALUACIÓN RÁPIDA (clasificador simple) ==================</span>
<span class="n">clf_eval</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s2">&quot;balanced&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">clf_eval</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_sel</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span>  <span class="o">=</span> <span class="n">clf_eval</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_sel</span><span class="p">)</span>
<span class="n">y_proba</span> <span class="o">=</span> <span class="n">clf_eval</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test_sel</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Métricas en Test (con features seleccionadas) ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ROC AUC:&quot;</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nº de variables seleccionadas: 17
Primeras seleccionadas: [&#39;int_rate&#39;, &#39;delinq_2yrs&#39;, &#39;fico_range_low&#39;, &#39;inq_last_6mths&#39;, &#39;pub_rec&#39;, &#39;tot_cur_bal&#39;, &#39;open_il_24m&#39;, &#39;il_util&#39;, &#39;open_rv_24m&#39;, &#39;total_rev_hi_lim&#39;, &#39;inq_last_12m&#39;, &#39;avg_cur_bal&#39;, &#39;bc_open_to_buy&#39;, &#39;mo_sin_rcnt_rev_tl_op&#39;, &#39;mths_since_recent_bc&#39;, &#39;mths_since_recent_inq&#39;, &#39;percent_bc_gt_75&#39;]

=== Métricas en Test (con features seleccionadas) ===
              precision    recall  f1-score   support

           0       0.95      0.65      0.77    182585
           1       0.15      0.64      0.24     17730

    accuracy                           0.64    200315
   macro avg       0.55      0.64      0.51    200315
weighted avg       0.88      0.64      0.72    200315

ROC AUC: 0.7001109895720945
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="c1"># --- subset con las variables seleccionadas + target ---</span>
<span class="n">df_corr</span> <span class="o">=</span> <span class="n">df_num</span><span class="p">[</span><span class="n">selected_original</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># --- matriz de correlación ---</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">df_corr</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="s2">&quot;spearman&quot;</span><span class="p">)</span>

<span class="c1"># --- plot ---</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">corr</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Mapa de calor - Variables seleccionadas vs Default&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0ebe081df3c54d8f9cf4d5bdb7d8a45e66b8f52f1dbbfb493678cd85e443d6a8.png" src="_images/0ebe081df3c54d8f9cf4d5bdb7d8a45e66b8f52f1dbbfb493678cd85e443d6a8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>default                  1.000000
int_rate                 0.198951
inq_last_6mths           0.080798
open_rv_24m              0.080700
percent_bc_gt_75         0.077922
inq_last_12m             0.073978
il_util                  0.061321
open_il_24m              0.054554
pub_rec                  0.035547
delinq_2yrs              0.020189
tot_cur_bal             -0.045905
avg_cur_bal             -0.056275
mths_since_recent_bc    -0.057153
mths_since_recent_inq   -0.063826
mo_sin_rcnt_rev_tl_op   -0.064443
total_rev_hi_lim        -0.066409
bc_open_to_buy          -0.098337
fico_range_low          -0.122101
Name: default, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="seleccion-de-variables-categorricas">
<h2>Selección de variables categórricas<a class="headerlink" href="#seleccion-de-variables-categorricas" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid_cats</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cat_cols</span> <span class="k">if</span> <span class="n">df_cat</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">valid_cats</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_cats</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;term&#39;, &#39;grade&#39;, &#39;sub_grade&#39;, &#39;emp_length&#39;, &#39;home_ownership&#39;, &#39;verification_status&#39;, &#39;pymnt_plan&#39;, &#39;purpose&#39;, &#39;addr_state&#39;, &#39;initial_list_status&#39;, &#39;application_type&#39;, &#39;hardship_flag&#39;, &#39;disbursement_method&#39;]
13
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_cat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>term</th>
      <th>grade</th>
      <th>sub_grade</th>
      <th>emp_length</th>
      <th>home_ownership</th>
      <th>verification_status</th>
      <th>pymnt_plan</th>
      <th>purpose</th>
      <th>addr_state</th>
      <th>initial_list_status</th>
      <th>application_type</th>
      <th>hardship_flag</th>
      <th>disbursement_method</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>36 months</td>
      <td>C</td>
      <td>C4</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>Not Verified</td>
      <td>n</td>
      <td>debt_consolidation</td>
      <td>PA</td>
      <td>w</td>
      <td>Individual</td>
      <td>N</td>
      <td>Cash</td>
    </tr>
    <tr>
      <th>1</th>
      <td>36 months</td>
      <td>C</td>
      <td>C1</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>Not Verified</td>
      <td>n</td>
      <td>small_business</td>
      <td>SD</td>
      <td>w</td>
      <td>Individual</td>
      <td>N</td>
      <td>Cash</td>
    </tr>
    <tr>
      <th>2</th>
      <td>60 months</td>
      <td>B</td>
      <td>B4</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>Not Verified</td>
      <td>n</td>
      <td>home_improvement</td>
      <td>IL</td>
      <td>w</td>
      <td>Joint App</td>
      <td>N</td>
      <td>Cash</td>
    </tr>
    <tr>
      <th>3</th>
      <td>60 months</td>
      <td>C</td>
      <td>C5</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>Source Verified</td>
      <td>n</td>
      <td>debt_consolidation</td>
      <td>NJ</td>
      <td>w</td>
      <td>Individual</td>
      <td>N</td>
      <td>Cash</td>
    </tr>
    <tr>
      <th>4</th>
      <td>60 months</td>
      <td>F</td>
      <td>F1</td>
      <td>3 years</td>
      <td>MORTGAGE</td>
      <td>Source Verified</td>
      <td>n</td>
      <td>major_purchase</td>
      <td>PA</td>
      <td>w</td>
      <td>Individual</td>
      <td>N</td>
      <td>Cash</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2260696</th>
      <td>60 months</td>
      <td>B</td>
      <td>B3</td>
      <td>9 years</td>
      <td>MORTGAGE</td>
      <td>Verified</td>
      <td>n</td>
      <td>debt_consolidation</td>
      <td>CA</td>
      <td>f</td>
      <td>Individual</td>
      <td>N</td>
      <td>Cash</td>
    </tr>
    <tr>
      <th>2260697</th>
      <td>60 months</td>
      <td>C</td>
      <td>C4</td>
      <td>6 years</td>
      <td>RENT</td>
      <td>Not Verified</td>
      <td>n</td>
      <td>debt_consolidation</td>
      <td>FL</td>
      <td>f</td>
      <td>Individual</td>
      <td>N</td>
      <td>Cash</td>
    </tr>
    <tr>
      <th>2260698</th>
      <td>60 months</td>
      <td>C</td>
      <td>C4</td>
      <td>10+ years</td>
      <td>MORTGAGE</td>
      <td>Verified</td>
      <td>n</td>
      <td>debt_consolidation</td>
      <td>TX</td>
      <td>w</td>
      <td>Individual</td>
      <td>N</td>
      <td>Cash</td>
    </tr>
    <tr>
      <th>2260699</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2260700</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>2260701 rows × 13 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">catboost</span><span class="w"> </span><span class="kn">import</span> <span class="n">CatBoostClassifier</span><span class="p">,</span> <span class="n">Pool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># --- Preparación de datos ---</span>
<span class="c1"># df_pre: tu dataset ya filtrado a variables &quot;pre&quot; (sin post-evento) + &#39;default&#39;</span>
<span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_num</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_cat</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Identificar categóricas y numéricas</span>
<span class="n">cat_cols</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">,</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_cols</span><span class="p">]</span>

<span class="c1"># CatBoost requiere índices (posiciones) de las categóricas</span>
<span class="n">cat_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cat_cols</span><span class="p">]</span>

<span class="c1">#Bota los nans}</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>



<span class="c1"># Pools (CatBoost maneja NaN; en categóricas usa strings)</span>
<span class="n">train_pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cat_features</span><span class="o">=</span><span class="n">cat_idx</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="n">test_pool</span>  <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span>  <span class="n">y_test</span><span class="p">,</span>  <span class="n">cat_features</span><span class="o">=</span><span class="n">cat_idx</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="c1"># --- Modelo CatBoost (simple y robusto) ---</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CatBoostClassifier</span><span class="p">(</span>
    <span class="n">iterations</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span>
    <span class="c1">#loss_function=&quot;Logloss&quot;,</span>
    <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;AUC&quot;</span><span class="p">,</span>
    <span class="n">auto_class_weights</span><span class="o">=</span><span class="s2">&quot;Balanced&quot;</span><span class="p">,</span>
    <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_pool</span><span class="p">,</span> <span class="n">eval_set</span><span class="o">=</span><span class="n">test_pool</span><span class="p">,</span> <span class="n">use_best_model</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0:	test: 0.6830329	best: 0.6830329 (0)	total: 1.82s	remaining: 18m 13s
100:	test: 0.7137165	best: 0.7137165 (100)	total: 54s	remaining: 4m 26s
200:	test: 0.7147952	best: 0.7147952 (200)	total: 1m 44s	remaining: 3m 26s
300:	test: 0.7152330	best: 0.7152330 (300)	total: 2m 40s	remaining: 2m 39s
400:	test: 0.7153723	best: 0.7153723 (400)	total: 3m 34s	remaining: 1m 46s
500:	test: 0.7154313	best: 0.7154448 (468)	total: 4m 35s	remaining: 54.5s
599:	test: 0.7154480	best: 0.7154582 (580)	total: 5m 27s	remaining: 0us

bestTest = 0.7154581578
bestIteration = 580

Shrink model to first 581 iterations.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;catboost.core.CatBoostClassifier at 0x15a6f9001c0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vector de importancias (una por feature en X.columns)</span>
<span class="n">imp_predchg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">(</span><span class="n">train_pool</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;PredictionValuesChange&quot;</span><span class="p">)</span>
<span class="n">fi_predchg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;feature&quot;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;importance&quot;</span><span class="p">:</span> <span class="n">imp_predchg</span><span class="p">})</span> \
              <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Top categóricas únicamente</span>
<span class="n">fi_cat</span> <span class="o">=</span> <span class="n">fi_predchg</span><span class="p">[</span><span class="n">fi_predchg</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fi_cat</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                feature  importance
0                 grade   26.301877
1             sub_grade   23.926953
2   disbursement_method   19.592102
3      application_type    6.789882
4        home_ownership    4.438947
5   initial_list_status    4.394937
6   verification_status    3.818736
7                  term    2.958608
8            addr_state    2.771214
9               purpose    2.123213
10           emp_length    1.624043
11        hardship_flag    1.030252
12           pymnt_plan    0.229238
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top10_cat_features</span> <span class="o">=</span> <span class="n">fi_cat</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">top10_cat_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;grade&#39;, &#39;sub_grade&#39;, &#39;disbursement_method&#39;, &#39;application_type&#39;, &#39;home_ownership&#39;, &#39;initial_list_status&#39;, &#39;verification_status&#39;, &#39;term&#39;, &#39;addr_state&#39;, &#39;purpose&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imp_losschg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">(</span><span class="n">train_pool</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;LossFunctionChange&quot;</span><span class="p">)</span>
<span class="n">fi_losschg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;feature&quot;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;importance&quot;</span><span class="p">:</span> <span class="n">imp_losschg</span><span class="p">})</span> \
              <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fi_cat_loss</span> <span class="o">=</span> <span class="n">fi_losschg</span><span class="p">[</span><span class="n">fi_losschg</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fi_cat_loss</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                feature  importance
2             sub_grade    0.007366
1                 grade    0.007084
12  disbursement_method    0.003739
10     application_type    0.002165
9   initial_list_status    0.001814
4        home_ownership    0.001090
5   verification_status    0.000957
8            addr_state    0.000738
7               purpose    0.000471
3            emp_length    0.000412
0                  term    0.000356
11        hardship_flag    0.000053
6            pymnt_plan    0.000002
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get_feature_importance(..., type=&quot;ShapValues&quot;) retorna matriz (n_samples, n_features+1)</span>
<span class="c1"># La última columna suele ser el valor base; usamos la media absoluta por feature.</span>
<span class="n">shap_vals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">(</span><span class="n">train_pool</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ShapValues&quot;</span><span class="p">)</span>
<span class="n">shap_abs_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">shap_vals</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># excluir base</span>
<span class="n">fi_shap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;feature&quot;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="s2">&quot;importance&quot;</span><span class="p">:</span> <span class="n">shap_abs_mean</span><span class="p">})</span> \
           <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fi_cat_shap</span> <span class="o">=</span> <span class="n">fi_shap</span><span class="p">[</span><span class="n">fi_shap</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cat_cols</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fi_cat_shap</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                feature  importance
2             sub_grade    0.289448
1                 grade    0.252767
12  disbursement_method    0.137565
9   initial_list_status    0.112546
5   verification_status    0.097655
4        home_ownership    0.092330
10     application_type    0.074587
8            addr_state    0.054420
7               purpose    0.040758
0                  term    0.034967
3            emp_length    0.032707
11        hardship_flag    0.002755
6            pymnt_plan    0.000492
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_lihki</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[[</span><span class="s1">&#39;loan_amnt&#39;</span><span class="p">,</span> <span class="s1">&#39;int_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;fico_range_high&#39;</span><span class="p">,</span> <span class="s1">&#39;emp_length&#39;</span><span class="p">,</span> <span class="s1">&#39;annual_inc&#39;</span><span class="p">,</span> <span class="s1">&#39;purpose&#39;</span><span class="p">,</span> <span class="s1">&#39;home_ownership&#39;</span><span class="p">,</span> <span class="s1">&#39;dti&#39;</span><span class="p">,</span> <span class="s1">&#39;addr_state&#39;</span><span class="p">,</span><span class="s1">&#39;default&#39;</span><span class="p">]]</span>
<span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_copy</span><span class="p">[[</span><span class="s1">&#39;loan_amnt&#39;</span><span class="p">,</span> <span class="s1">&#39;int_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;fico_range_low&#39;</span><span class="p">,</span> <span class="s1">&#39;open_rv_24m&#39;</span>
                   <span class="p">,</span> <span class="s1">&#39;grade&#39;</span><span class="p">,</span> <span class="s1">&#39;sub_grade&#39;</span><span class="p">,</span> <span class="s1">&#39;disbursement_method&#39;</span><span class="p">,</span> <span class="s1">&#39;application_type&#39;</span><span class="p">,</span> <span class="s1">&#39;initial_list_status&#39;</span><span class="p">,</span> <span class="s1">&#39;home_ownership&#39;</span><span class="p">,</span> <span class="s1">&#39;verification_status&#39;</span><span class="p">,</span> <span class="s1">&#39;term&#39;</span><span class="p">,</span> <span class="s1">&#39;addr_state&#39;</span>
                   <span class="p">,</span><span class="s1">&#39;default&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_copy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loan_amnt</th>
      <th>int_rate</th>
      <th>fico_range_low</th>
      <th>open_rv_24m</th>
      <th>grade</th>
      <th>sub_grade</th>
      <th>disbursement_method</th>
      <th>application_type</th>
      <th>initial_list_status</th>
      <th>home_ownership</th>
      <th>verification_status</th>
      <th>term</th>
      <th>addr_state</th>
      <th>default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3600.0</td>
      <td>13.99</td>
      <td>675.0</td>
      <td>3.0</td>
      <td>C</td>
      <td>C4</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Not Verified</td>
      <td>36 months</td>
      <td>PA</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>24700.0</td>
      <td>11.99</td>
      <td>715.0</td>
      <td>3.0</td>
      <td>C</td>
      <td>C1</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Not Verified</td>
      <td>36 months</td>
      <td>SD</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20000.0</td>
      <td>10.78</td>
      <td>695.0</td>
      <td>2.0</td>
      <td>B</td>
      <td>B4</td>
      <td>Cash</td>
      <td>Joint App</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Not Verified</td>
      <td>60 months</td>
      <td>IL</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>35000.0</td>
      <td>14.85</td>
      <td>785.0</td>
      <td>1.0</td>
      <td>C</td>
      <td>C5</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Source Verified</td>
      <td>60 months</td>
      <td>NJ</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10400.0</td>
      <td>22.45</td>
      <td>695.0</td>
      <td>7.0</td>
      <td>F</td>
      <td>F1</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Source Verified</td>
      <td>60 months</td>
      <td>PA</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2260696</th>
      <td>40000.0</td>
      <td>10.49</td>
      <td>705.0</td>
      <td>0.0</td>
      <td>B</td>
      <td>B3</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>f</td>
      <td>MORTGAGE</td>
      <td>Verified</td>
      <td>60 months</td>
      <td>CA</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260697</th>
      <td>24000.0</td>
      <td>14.49</td>
      <td>660.0</td>
      <td>5.0</td>
      <td>C</td>
      <td>C4</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>f</td>
      <td>RENT</td>
      <td>Not Verified</td>
      <td>60 months</td>
      <td>FL</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2260698</th>
      <td>14000.0</td>
      <td>14.49</td>
      <td>660.0</td>
      <td>1.0</td>
      <td>C</td>
      <td>C4</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Verified</td>
      <td>60 months</td>
      <td>TX</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260699</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2260700</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2260701 rows × 14 columns</p>
</div></div></div>
</div>
</section>
<section id="escalado">
<h2>Escalado<a class="headerlink" href="#escalado" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_copy</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2260701 entries, 0 to 2260700
Data columns (total 14 columns):
 #   Column               Dtype  
---  ------               -----  
 0   loan_amnt            float64
 1   int_rate             float64
 2   fico_range_low       float64
 3   open_rv_24m          float64
 4   grade                object 
 5   sub_grade            object 
 6   disbursement_method  object 
 7   application_type     object 
 8   initial_list_status  object 
 9   home_ownership       object 
 10  verification_status  object 
 11  term                 object 
 12  addr_state           object 
 13  default              int64  
dtypes: float64(4), int64(1), object(9)
memory usage: 241.5+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Identificar columnas numéricas</span>
<span class="n">num_features</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># 2. Escalador</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="n">num_features</span><span class="p">])</span>

<span class="c1"># 3. Reemplazar en el DataFrame</span>
<span class="n">df_copy</span><span class="p">[</span><span class="n">num_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="codificacion-de-categoricas">
<h2>Codificación de categóricas<a class="headerlink" href="#codificacion-de-categoricas" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">df_copy</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">]</span>

<span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_copy</span><span class="p">[</span><span class="n">cat_features</span><span class="p">])</span>

<span class="c1"># Convertimos a DataFrame con nombres de columnas</span>
<span class="n">encoded_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">encoded</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">encoder</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">(</span><span class="n">cat_features</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df_copy</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="c1"># Unimos al dataset original (quitando las categóricas originales)</span>
<span class="n">df_encoded</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cat_features</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">encoded_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_encoded</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loan_amnt</th>
      <th>int_rate</th>
      <th>fico_range_low</th>
      <th>open_rv_24m</th>
      <th>default</th>
      <th>grade_B</th>
      <th>grade_C</th>
      <th>grade_D</th>
      <th>grade_E</th>
      <th>grade_F</th>
      <th>...</th>
      <th>addr_state_SD</th>
      <th>addr_state_TN</th>
      <th>addr_state_TX</th>
      <th>addr_state_UT</th>
      <th>addr_state_VA</th>
      <th>addr_state_VT</th>
      <th>addr_state_WA</th>
      <th>addr_state_WI</th>
      <th>addr_state_WV</th>
      <th>addr_state_WY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.245553</td>
      <td>0.185668</td>
      <td>-0.714570</td>
      <td>0.096298</td>
      <td>0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.050361</td>
      <td>-0.228228</td>
      <td>0.497171</td>
      <td>0.096298</td>
      <td>0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.538949</td>
      <td>-0.478635</td>
      <td>-0.108699</td>
      <td>-0.288775</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.171114</td>
      <td>0.363643</td>
      <td>2.617717</td>
      <td>-0.673848</td>
      <td>0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.505637</td>
      <td>1.936446</td>
      <td>-0.108699</td>
      <td>1.636590</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2260694</th>
      <td>0.974193</td>
      <td>-0.062670</td>
      <td>-1.017505</td>
      <td>-0.288775</td>
      <td>0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2260695</th>
      <td>0.974193</td>
      <td>-0.538650</td>
      <td>-0.108699</td>
      <td>-0.288775</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2260696</th>
      <td>2.715170</td>
      <td>-0.538650</td>
      <td>0.194236</td>
      <td>-1.058921</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2260697</th>
      <td>0.974193</td>
      <td>0.289141</td>
      <td>-1.168972</td>
      <td>0.866444</td>
      <td>1</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2260698</th>
      <td>-0.113918</td>
      <td>0.289141</td>
      <td>-1.168972</td>
      <td>-0.673848</td>
      <td>0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1394539 rows × 104 columns</p>
</div></div></div>
</div>
</section>
<section id="division-del-train-y-test-por-clase">
<h2>División del train y test por clase<a class="headerlink" href="#division-del-train-y-test-por-clase" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_copy</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loan_amnt</th>
      <th>int_rate</th>
      <th>fico_range_low</th>
      <th>open_rv_24m</th>
      <th>grade</th>
      <th>sub_grade</th>
      <th>disbursement_method</th>
      <th>application_type</th>
      <th>initial_list_status</th>
      <th>home_ownership</th>
      <th>verification_status</th>
      <th>term</th>
      <th>addr_state</th>
      <th>default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.245553</td>
      <td>0.185668</td>
      <td>-0.714570</td>
      <td>0.096298</td>
      <td>C</td>
      <td>C4</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Not Verified</td>
      <td>36 months</td>
      <td>PA</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.050361</td>
      <td>-0.228228</td>
      <td>0.497171</td>
      <td>0.096298</td>
      <td>C</td>
      <td>C1</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Not Verified</td>
      <td>36 months</td>
      <td>SD</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.538949</td>
      <td>-0.478635</td>
      <td>-0.108699</td>
      <td>-0.288775</td>
      <td>B</td>
      <td>B4</td>
      <td>Cash</td>
      <td>Joint App</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Not Verified</td>
      <td>60 months</td>
      <td>IL</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.171114</td>
      <td>0.363643</td>
      <td>2.617717</td>
      <td>-0.673848</td>
      <td>C</td>
      <td>C5</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Source Verified</td>
      <td>60 months</td>
      <td>NJ</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.505637</td>
      <td>1.936446</td>
      <td>-0.108699</td>
      <td>1.636590</td>
      <td>F</td>
      <td>F1</td>
      <td>Cash</td>
      <td>Individual</td>
      <td>w</td>
      <td>MORTGAGE</td>
      <td>Source Verified</td>
      <td>60 months</td>
      <td>PA</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definimos variables predictoras (X) y target (y)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_encoded</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_encoded</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>

<span class="c1"># División 80/20 con estratificación por clase</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">stratify</span><span class="o">=</span><span class="n">y</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_encoded</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribución de la variable default&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Set2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribución de la variable default en y_train&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/745e275398ab1d57396d0a3d1ce58584acd03d2a701b0b8f80c1c21e8eabb4b1.png" src="_images/745e275398ab1d57396d0a3d1ce58584acd03d2a701b0b8f80c1c21e8eabb4b1.png" />
<img alt="_images/f243c71ebab47b82f3cd6cc4c379790e82915a5ceaad9435fa2450e24947e10a.png" src="_images/f243c71ebab47b82f3cd6cc4c379790e82915a5ceaad9435fa2450e24947e10a.png" />
</div>
</div>
</section>
<section id="modelado-con-scikit-learn">
<h2>Modelado con Scikit learn<a class="headerlink" href="#modelado-con-scikit-learn" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neural_network</span><span class="w"> </span><span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span>
    <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="c1">#(&quot;scaler&quot;, StandardScaler()),   # X ya está escalada</span>
    <span class="p">(</span><span class="s2">&quot;clf&quot;</span><span class="p">,</span> <span class="n">MLPClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">early_stopping</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="p">])</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;clf__hidden_layer_sizes&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">10</span><span class="p">,),</span> <span class="p">(</span><span class="mi">50</span><span class="p">,),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,)],</span>
    <span class="s2">&quot;clf__alpha&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span>
    <span class="s2">&quot;clf__max_iter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="s2">&quot;precision&quot;</span><span class="p">,</span>
    <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;roc_auc&quot;</span><span class="p">:</span> <span class="s2">&quot;roc_auc&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipe</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span>
    <span class="n">refit</span><span class="o">=</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span>          <span class="c1"># el mejor modelo se elige por F1</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParameterGrid</span><span class="p">,</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm_joblib</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm_joblib</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipe</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span>
    <span class="n">refit</span><span class="o">=</span><span class="s2">&quot;roc_auc&quot;</span><span class="p">,</span>          <span class="c1"># el mejor modelo se elige por auc</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

<span class="k">with</span> <span class="n">tqdm_joblib</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;GridSearch MLP&quot;</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">)))</span> <span class="o">*</span> <span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">())):</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearch MLP:   0%|          | 0/54 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "332fa254c193471cb6e1da9b701ed106", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 3 folds for each of 18 candidates, totalling 54 fits
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GridSearch completed in </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GridSearch completed in </span><span class="si">{</span><span class="n">elapsed</span><span class="o">/</span><span class="mi">60</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> minutes&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearch completed in 808.55 seconds
GridSearch completed in 13.48 minutes
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mejores hiperparámetros:&quot;</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejores hiperparámetros: {&#39;clf__alpha&#39;: 0.01, &#39;clf__hidden_layer_sizes&#39;: (100,), &#39;clf__max_iter&#39;: 100}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># 1) VALID a partir de TRAIN</span>
<span class="n">X_tr</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_tr</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                            <span class="n">stratify</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># 2) Reentrenar el MEJOR pipeline en TRAIN interno</span>
<span class="n">best</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_tr</span><span class="p">,</span> <span class="n">y_tr</span><span class="p">)</span>

<span class="c1"># 3) Probabilidades en VALID y umbral óptimo por F1</span>
<span class="n">proba_val</span> <span class="o">=</span> <span class="n">best</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_val</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">prec</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="n">thr</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">proba_val</span><span class="p">)</span>
<span class="n">f1s</span>  <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">prec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">prec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">rec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-9</span><span class="p">)</span>  <span class="c1"># len(thr)=len(prec)-1</span>
<span class="n">t_f1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">thr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">f1s</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Umbral óptimo (F1):&quot;</span><span class="p">,</span> <span class="n">t_f1</span><span class="p">)</span>

<span class="c1"># 4) Reentrenar con TODO el TRAIN y evalúe en TEST con ese umbral</span>
<span class="n">final_model</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">proba_test</span>  <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_pred_t</span>    <span class="o">=</span> <span class="p">(</span><span class="n">proba_test</span> <span class="o">&gt;=</span> <span class="n">t_f1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AUC      :&quot;</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">proba_test</span><span class="p">))</span>  <span class="c1"># no depende del umbral</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy :&quot;</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_t</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Precision:&quot;</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_t</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recall   :&quot;</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_t</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1-score :&quot;</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_t</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Umbral óptimo (F1): 0.14898812757371735
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearch MLP:   0%|          | 0/54 [18:06&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AUC      : 0.7675203351629311
Accuracy : 0.843278070188019
Precision: 0.24667438569406921
Recall   : 0.3991257285595337
F1-score : 0.3049057803927805
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">precision_recall_curve</span>

<span class="c1"># y_val: etiquetas reales 0/1 del set de validación</span>
<span class="c1"># proba_val: probabilidades del modelo (clase 1) en VALID</span>
<span class="n">prec</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="n">thr</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">proba_val</span><span class="p">)</span>  <span class="c1"># len(thr)=len(prec)-1</span>

<span class="c1"># Alinear con los umbrales</span>
<span class="n">prec_</span> <span class="o">=</span> <span class="n">prec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">rec_</span>  <span class="o">=</span> <span class="n">rec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">thr_</span>  <span class="o">=</span> <span class="n">thr</span>

<span class="c1"># Reconstrucción de TP/FP/TN para accuracy</span>
<span class="n">P</span>  <span class="o">=</span> <span class="p">(</span><span class="n">y_val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">Nn</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">tp</span> <span class="o">=</span> <span class="n">rec_</span> <span class="o">*</span> <span class="n">P</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">prec_</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Nn</span><span class="p">)</span>
<span class="n">tn</span> <span class="o">=</span> <span class="n">Nn</span> <span class="o">-</span> <span class="n">fp</span>
<span class="n">acc_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="n">Nn</span><span class="p">)</span>

<span class="c1"># F1 por umbral</span>
<span class="n">f1_s</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">prec_</span><span class="o">*</span><span class="n">rec_</span> <span class="o">/</span> <span class="p">(</span><span class="n">prec_</span> <span class="o">+</span> <span class="n">rec_</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span>

<span class="c1"># Umbrales óptimos</span>
<span class="n">t_accuracy</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">thr_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">acc_s</span><span class="p">)])</span>
<span class="n">t_precision</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">thr_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">prec_</span><span class="p">)])</span>
<span class="n">t_recall</span>    <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">thr_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">rec_</span><span class="p">)])</span>
<span class="n">t_f1</span>        <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">thr_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">f1_s</span><span class="p">)])</span>

<span class="nb">print</span><span class="p">({</span>
    <span class="s2">&quot;t_accuracy&quot;</span><span class="p">:</span>  <span class="n">t_accuracy</span><span class="p">,</span>
    <span class="s2">&quot;t_precision&quot;</span><span class="p">:</span> <span class="n">t_precision</span><span class="p">,</span>
    <span class="s2">&quot;t_recall&quot;</span><span class="p">:</span>    <span class="n">t_recall</span><span class="p">,</span>
    <span class="s2">&quot;t_f1&quot;</span><span class="p">:</span>        <span class="n">t_f1</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;t_accuracy&#39;: 0.597859216156902, &#39;t_precision&#39;: 0.7011071258075341, &#39;t_recall&#39;: 0.0006319686375899121, &#39;t_f1&#39;: 0.14898812757371735}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ===== EVALUACIÓN EN TEST =====</span>
<span class="n">best</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span>
<span class="c1">#y_pred  = best.predict(X_test)</span>
<span class="n">y_proba</span> <span class="o">=</span> <span class="n">best</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_pred</span>    <span class="o">=</span> <span class="p">(</span><span class="n">y_proba</span> <span class="o">&gt;=</span> <span class="n">t_f1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">acc</span>  <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">prec</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rec</span>  <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">f1</span>   <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">auc</span>  <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Métricas en Test ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy : </span><span class="si">{</span><span class="n">acc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Precision: </span><span class="si">{</span><span class="n">prec</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recall   : </span><span class="si">{</span><span class="n">rec</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1-score : </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ROC AUC  : </span><span class="si">{</span><span class="n">auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Classification report ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">cm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Real_0&quot;</span><span class="p">,</span> <span class="s2">&quot;Real_1&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Pred_0&quot;</span><span class="p">,</span> <span class="s2">&quot;Pred_1&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Matriz de Confusión ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cm_df</span><span class="p">)</span>

<span class="c1"># ===== TOP CV RESULTS =====</span>
<span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;param_clf__hidden_layer_sizes&quot;</span><span class="p">,</span> <span class="s2">&quot;param_clf__alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;param_clf__max_iter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mean_test_accuracy&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_test_precision&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_test_recall&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mean_test_f1&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_test_roc_auc&quot;</span><span class="p">,</span> <span class="s2">&quot;rank_test_f1&quot;</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Top resultados de CV (ordenado por F1) ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;rank_test_f1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># ===== CURVA DE PÉRDIDA (del mejor MLP) =====</span>
<span class="n">mlp</span> <span class="o">=</span> <span class="n">best</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;clf&quot;</span><span class="p">]</span>  <span class="c1"># toma el clasificador dentro del pipeline</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mlp</span><span class="p">,</span> <span class="s2">&quot;loss_curve_&quot;</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mlp</span><span class="o">.</span><span class="n">loss_curve_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pérdida de entrenamiento&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Curva de pérdida (best estimator)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Épocas&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Métricas en Test ===
Accuracy : 0.8433
Precision: 0.2467
Recall   : 0.3991
F1-score : 0.3049
ROC AUC  : 0.7675

=== Classification report ===
              precision    recall  f1-score   support

           0       0.94      0.89      0.91    254888
           1       0.25      0.40      0.30     24020

    accuracy                           0.84    278908
   macro avg       0.59      0.64      0.61    278908
weighted avg       0.88      0.84      0.86    278908


=== Matriz de Confusión ===
        Pred_0  Pred_1
Real_0  225610   29278
Real_1   14433    9587

=== Top resultados de CV (ordenado por F1) ===
   param_clf__hidden_layer_sizes  param_clf__alpha  param_clf__max_iter  \
2                          (50,)            0.0001                  100   
8                          (50,)            0.0010                  100   
9                          (50,)            0.0010                  200   
11                        (100,)            0.0010                  200   
10                        (100,)            0.0010                  100   
15                         (50,)            0.0100                  200   
14                         (50,)            0.0100                  100   
16                        (100,)            0.0100                  100   
17                        (100,)            0.0100                  200   
12                         (10,)            0.0100                  100   

    mean_test_accuracy  mean_test_precision  mean_test_recall  mean_test_f1  \
2             0.913804             0.505624          0.009919      0.019143   
8             0.913797             0.501262          0.009399      0.018173   
9             0.913797             0.501262          0.009399      0.018173   
11            0.913857             0.498022          0.008514      0.016726   
10            0.913857             0.498022          0.008514      0.016726   
15            0.913804             0.505271          0.007962      0.015444   
14            0.913804             0.505271          0.007962      0.015444   
16            0.913847             0.486113          0.006901      0.013597   
17            0.913847             0.486113          0.006901      0.013597   
12            0.913874             0.487060          0.000458      0.000914   

    mean_test_roc_auc  rank_test_f1  
2            0.739706             1  
8            0.738882             2  
9            0.738882             2  
11           0.735138             4  
10           0.735138             4  
15           0.732837             6  
14           0.732837             6  
16           0.743936             8  
17           0.743936             8  
12           0.717967            10  
</pre></div>
</div>
<img alt="_images/3c6dfcb5d478255f0c2580ffab54204142f826b488bc597d8a1c4a9897d484b4.png" src="_images/3c6dfcb5d478255f0c2580ffab54204142f826b488bc597d8a1c4a9897d484b4.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">MLP en clasificación</p>
      </div>
    </a>
    <a class="right-next"
       href="Pyspark.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Proyecto Integrador de Aprendizaje Automático</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eliminacion-de-columnas-con-mas-del-50-de-na">Eliminación de columnas con mas del 50% de NA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eliminacion-de-columnas-tipo-object-que-tienen-demasiadas-categorias">Eliminación de columnas tipo Object que tienen demasiadas categorías</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seleccion-de-variables-numericas">Selección de variables numéricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seleccion-de-variables-categorricas">Selección de variables categórricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#escalado">Escalado</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#codificacion-de-categoricas">Codificación de categóricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#division-del-train-y-test-por-clase">División del train y test por clase</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelado-con-scikit-learn">Modelado con Scikit learn</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Eliasib Pájaro Retamoza
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>